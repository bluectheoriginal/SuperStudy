<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SuperStudy Pro - Your Personal Study Tool</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(to right, #4a00e0, #8e2de2);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .tabs {
            display: flex;
            background-color: #f1f1f1;
            border-bottom: 1px solid #ddd;
        }
        
        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .tab.active {
            background-color: white;
            border-bottom: 3px solid #4a00e0;
            color: #4a00e0;
        }
        
        .tab:hover:not(.active) {
            background-color: #e9e9e9;
        }
        
        .content {
            padding: 30px;
            min-height: 500px;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        input[type="text"], textarea, select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
        }
        
        textarea {
            min-height: 80px;
            resize: vertical;
        }
        
        .answer-row {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: 8px;
        }
        
        .answer-row input[type="text"] {
            flex: 1;
            margin-right: 10px;
        }
        
        .checkbox-container {
            display: flex;
            align-items: center;
            cursor: pointer;
        }
        
        .checkbox-container input {
            margin-right: 5px;
        }
        
        button {
            background: linear-gradient(to right, #4a00e0, #8e2de2);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        button.secondary {
            background: #f1f1f1;
            color: #333;
        }
        
        button.success {
            background: linear-gradient(to right, #28a745, #20c997);
        }
        
        button.warning {
            background: linear-gradient(to right, #ffc107, #fd7e14);
        }
        
        .question-card {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            border-left: 5px solid #4a00e0;
        }
        
        .question-title {
            font-size: 1.3rem;
            margin-bottom: 15px;
            font-weight: 600;
        }
        
        .answer-option {
            padding: 12px;
            margin-bottom: 10px;
            background-color: #f9f9f9;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .answer-option:hover {
            background-color: #e9e9e9;
        }
        
        .answer-option.selected {
            background-color: #e0e7ff;
            border-left: 4px solid #4a00e0;
        }
        
        .answer-option.correct {
            background-color: #d4edda;
            border-left: 4px solid #28a745;
        }
        
        .answer-option.incorrect {
            background-color: #f8d7da;
            border-left: 4px solid #dc3545;
        }
        
        .quiz-controls {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        
        .progress-bar {
            height: 8px;
            background-color: #e9ecef;
            border-radius: 4px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            background: linear-gradient(to right, #4a00e0, #8e2de2);
            width: 0%;
            transition: width 0.3s;
        }
        
        .results {
            text-align: center;
            padding: 30px;
        }
        
        .score {
            font-size: 3rem;
            font-weight: 700;
            color: #4a00e0;
            margin: 20px 0;
        }
        
        .study-guide-list {
            list-style-type: none;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .study-guide-item {
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            transition: transform 0.2s;
        }
        
        .study-guide-item:hover {
            transform: translateY(-5px);
        }
        
        .guide-thumbnail {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 5px;
            margin-bottom: 10px;
            background-color: #e9ecef;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6c757d;
        }
        
        .guide-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 5px;
        }
        
        .guide-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #6c757d;
            grid-column: 1 / -1;
        }
        
        .empty-state i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: #adb5bd;
        }
        
        .instant-feedback-container {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding: 10px;
            background-color: #f0f8ff;
            border-radius: 8px;
        }
        
        .instant-feedback-container input {
            margin-right: 10px;
        }
        
        .feedback-message {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            font-weight: 500;
            display: none;
        }
        
        .feedback-correct {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .feedback-incorrect {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .storage-info {
            background-color: #e7f3ff;
            padding: 10px;
            border-radius: 8px;
            margin-top: 20px;
            font-size: 0.9rem;
            color: #0066cc;
        }
        
        .storage-info.warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .action-buttons {
            display: flex;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        
        .image-upload-container {
            margin-bottom: 20px;
        }
        
        .thumbnail-preview {
            width: 200px;
            height: 120px;
            border: 2px dashed #ddd;
            border-radius: 8px;
            margin-top: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            background-color: #f9f9f9;
        }
        
        .thumbnail-preview img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        
        .search-container {
            margin-bottom: 20px;
        }
        
        .search-box {
            display: flex;
        }
        
        .search-box input {
            flex: 1;
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
        }
        
        .search-box button {
            border-top-left-radius: 0;
            border-bottom-left-radius: 0;
            margin: 0;
        }
        
        .published-badge {
            display: inline-block;
            background-color: #28a745;
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            margin-left: 10px;
        }
        
        .guide-meta {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 0.9rem;
            color: #6c757d;
        }
        
        .submit-section {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            border-left: 4px solid #4a00e0;
        }
        
        @media (max-width: 768px) {
            .container {
                margin: 10px;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .answer-row {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .answer-row input[type="text"] {
                width: 100%;
                margin-bottom: 10px;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .action-buttons button {
                width: 100%;
                margin-right: 0;
            }
            
            .study-guide-list {
                grid-template-columns: 1fr;
            }
            
            .guide-actions {
                flex-direction: column;
            }
            
            .guide-actions button {
                width: 100%;
                margin-bottom: 5px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>SuperStudy Pro</h1>
            <p class="subtitle">By: Ryker Hernandez</p>
            <p class="subtitle">Create, study, and master any subject</p>
        </header>
        
        <div class="tabs">
            <div class="tab active" data-tab="create">Create Study Guide</div>
            <div class="tab" data-tab="study">Study Mode</div>
            <div class="tab" data-tab="guides">My Study Guides</div>
            <div class="tab" data-tab="browse">Browse & Search</div>
        </div>
        
        <div class="content">
            <!-- Create Study Guide Tab -->
            <div class="tab-content active" id="create">
                <div class="form-group">
                    <label for="guide-title">Study Guide Title</label>
                    <input type="text" id="guide-title" placeholder="Enter a title for your study guide">
                </div>
                
                <div class="form-group">
                    <label for="guide-description">Description</label>
                    <textarea id="guide-description" placeholder="Enter a description for your study guide"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="guide-category">Category</label>
                    <select id="guide-category">
                        <option value="">Select a category</option>
                        <option value="math">Mathematics</option>
                        <option value="science">Science</option>
                        <option value="history">History</option>
                        <option value="language">Language</option>
                        <option value="technology">Technology</option>
                        <option value="arts">Arts</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                
                <div class="image-upload-container">
                    <label for="thumbnail-upload">Thumbnail Image (Optional)</label>
                    <input type="file" id="thumbnail-upload" accept="image/*">
                    <div class="thumbnail-preview" id="thumbnail-preview">
                        <span>No image selected</span>
                    </div>
                </div>
                
                <div id="questions-container">
                    <!-- Questions will be added here dynamically -->
                </div>
                
                <div class="action-buttons">
                    <button id="add-question">Add Question</button>
                    <button id="save-guide" class="success">Save Study Guide</button>
                    <button id="publish-guide" class="warning">Prepare for Publishing</button>
                </div>
                
                <div class="submit-section">
                    <h3>📤 Share Your Study Guide</h3>
                    <p>To make your guide available to everyone, copy the JSON data below and submit it to be included in the public collection:</p>
                    <textarea id="export-json" readonly style="width: 100%; height: 120px; margin: 10px 0; font-family: monospace; font-size: 0.8rem;"></textarea>
                    <button id="copy-json" class="secondary">Copy JSON</button>
                    <p><small>Your guide will be reviewed and added to the public collection in the next update.</small></p>
                </div>
                
                <div class="storage-info">
                    <strong>Note:</strong> Your study guides are automatically saved to your browser's local storage. 
                    They will persist even after you close the browser and will be available when you return to this site.
                </div>
            </div>
            
            <!-- Study Mode Tab -->
            <div class="tab-content" id="study">
                <div id="study-setup">
                    <div class="form-group">
                        <label for="select-guide">Select Study Guide</label>
                        <select id="select-guide" class="form-control">
                            <option value="">-- Select a study guide --</option>
                        </select>
                    </div>
                    
                    <div class="instant-feedback-container">
                        <input type="checkbox" id="instant-feedback">
                        <label for="instant-feedback">Show instant feedback (see if answers are correct immediately)</label>
                    </div>
                    
                    <button id="start-quiz">Start Quiz</button>
                </div>
                
                <div id="quiz-container" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress" id="quiz-progress"></div>
                    </div>
                    <div id="question-display">
                        <!-- Question will be displayed here -->
                    </div>
                    <div id="feedback-message" class="feedback-message"></div>
                    <div class="quiz-controls">
                        <button id="prev-question" class="secondary">Previous</button>
                        <button id="next-question">Next</button>
                    </div>
                </div>
                
                <div id="results-container" style="display: none;">
                    <!-- Results will be displayed here -->
                </div>
            </div>
            
            <!-- My Study Guides Tab -->
            <div class="tab-content" id="guides">
                <h2>My Study Guides</h2>
                <p>All your saved study guides are listed below. They are stored locally in your browser.</p>
                
                <div class="action-buttons">
                    <button id="export-all" class="secondary">Export All Guides</button>
                    <button id="import-guides" class="secondary">Import Guides</button>
                    <button id="clear-all" class="secondary">Clear All Guides</button>
                </div>
                
                <ul class="study-guide-list" id="guide-list">
                    <!-- Study guides will be listed here -->
                </ul>
                
                <input type="file" id="import-file" style="display: none;" accept=".json">
            </div>
            
            <!-- Browse & Search Tab -->
            <div class="tab-content" id="browse">
                <h2>Browse & Search Study Guides</h2>
                <p>Discover study guides from the community collection.</p>
                
                <div class="storage-info warning">
                    <strong>Community Guides:</strong> These study guides are loaded from a shared collection. 
                    To contribute your own guides, use the "Prepare for Publishing" feature in the Create tab.
                </div>
                
                <div class="search-container">
                    <div class="form-group">
                        <label for="search-input">Search Study Guides</label>
                        <div class="search-box">
                            <input type="text" id="search-input" placeholder="Search by title, description, or category">
                            <button id="search-button">Search</button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="category-filter">Filter by Category</label>
                        <select id="category-filter">
                            <option value="">All Categories</option>
                            <option value="math">Mathematics</option>
                            <option value="science">Science</option>
                            <option value="history">History</option>
                            <option value="language">Language</option>
                            <option value="technology">Technology</option>
                            <option value="arts">Arts</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button id="refresh-guides" class="secondary">Refresh Community Guides</button>
                </div>
                
                <ul class="study-guide-list" id="browse-guide-list">
                    <!-- Published study guides will be listed here -->
                </ul>
            </div>
        </div>
    </div>

    <script>
        // Study Guide Data Structure
        let studyGuides = JSON.parse(localStorage.getItem('studyGuides')) || [];
        let communityGuides = [];
        let currentGuide = null;
        let currentQuiz = null;
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let quizInProgress = false;
        let instantFeedbackEnabled = false;
        let editingGuideId = null;

        // DOM Elements
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        const questionsContainer = document.getElementById('questions-container');
        const addQuestionBtn = document.getElementById('add-question');
        const saveGuideBtn = document.getElementById('save-guide');
        const publishGuideBtn = document.getElementById('publish-guide');
        const selectGuide = document.getElementById('select-guide');
        const instantFeedbackCheckbox = document.getElementById('instant-feedback');
        const startQuizBtn = document.getElementById('start-quiz');
        const quizContainer = document.getElementById('quiz-container');
        const questionDisplay = document.getElementById('question-display');
        const feedbackMessage = document.getElementById('feedback-message');
        const prevQuestionBtn = document.getElementById('prev-question');
        const nextQuestionBtn = document.getElementById('next-question');
        const resultsContainer = document.getElementById('results-container');
        const guideList = document.getElementById('guide-list');
        const quizProgress = document.getElementById('quiz-progress');
        const exportAllBtn = document.getElementById('export-all');
        const importGuidesBtn = document.getElementById('import-guides');
        const clearAllBtn = document.getElementById('clear-all');
        const importFile = document.getElementById('import-file');
        const browseGuideList = document.getElementById('browse-guide-list');
        const searchInput = document.getElementById('search-input');
        const searchButton = document.getElementById('search-button');
        const categoryFilter = document.getElementById('category-filter');
        const thumbnailUpload = document.getElementById('thumbnail-upload');
        const thumbnailPreview = document.getElementById('thumbnail-preview');
        const guideDescription = document.getElementById('guide-description');
        const guideCategory = document.getElementById('guide-category');
        const exportJson = document.getElementById('export-json');
        const copyJsonBtn = document.getElementById('copy-json');
        const refreshGuidesBtn = document.getElementById('refresh-guides');

        // Initialize the app
        function init() {
            // Load study guides from localStorage
            updateGuideSelect();
            updateGuideList();
            loadCommunityGuides();
            
            // Add event listeners
            tabs.forEach(tab => {
                tab.addEventListener('click', () => switchTab(tab.dataset.tab));
            });
            
            addQuestionBtn.addEventListener('click', addQuestion);
            saveGuideBtn.addEventListener('click', saveStudyGuide);
            publishGuideBtn.addEventListener('click', prepareForPublishing);
            instantFeedbackCheckbox.addEventListener('change', function() {
                instantFeedbackEnabled = this.checked;
            });
            startQuizBtn.addEventListener('click', startQuiz);
            prevQuestionBtn.addEventListener('click', showPreviousQuestion);
            nextQuestionBtn.addEventListener('click', showNextQuestion);
            exportAllBtn.addEventListener('click', exportAllGuides);
            importGuidesBtn.addEventListener('click', () => importFile.click());
            importFile.addEventListener('change', importGuides);
            clearAllBtn.addEventListener('click', clearAllGuides);
            searchButton.addEventListener('click', updateBrowseList);
            searchInput.addEventListener('keyup', function(event) {
                if (event.key === 'Enter') {
                    updateBrowseList();
                }
            });
            categoryFilter.addEventListener('change', updateBrowseList);
            thumbnailUpload.addEventListener('change', handleThumbnailUpload);
            copyJsonBtn.addEventListener('click', copyJsonToClipboard);
            refreshGuidesBtn.addEventListener('click', loadCommunityGuides);
            
            // Add initial question
            addQuestion();
            
            // Show storage info if first visit
            if (!localStorage.getItem('studyGuides')) {
                localStorage.setItem('studyGuides', JSON.stringify([]));
            }
        }

        // Load community guides from JSON file
        async function loadCommunityGuides() {
            try {
                // Try to load from the published-guides.json file in your repo
                const response = await fetch('published-guides.json');
                if (response.ok) {
                    communityGuides = await response.json();
                    updateBrowseList();
                    console.log(`Loaded ${communityGuides.length} community guides`);
                } else {
                    throw new Error('No community guides file found');
                }
            } catch (error) {
                console.log('Community guides not available, using demo data');
                // Fallback to some demo data
                communityGuides = getDemoGuides();
                updateBrowseList();
            }
        }

        // Demo data for when no community file exists
        function getDemoGuides() {
            return [
                {
                    id: 'demo-math',
                    title: 'Basic Mathematics',
                    description: 'Fundamental math concepts for beginners',
                    category: 'math',
                    questions: [
                        {
                            question: 'What is 15 + 27?',
                            answers: ['32', '42', '52', '62'],
                            correctIndex: 1
                        },
                        {
                            question: 'What is 8 × 7?',
                            answers: ['48', '56', '64', '72'],
                            correctIndex: 1
                        }
                    ],
                    createdAt: '2023-01-01',
                    publishedAt: '2023-01-01'
                },
                {
                    id: 'demo-science',
                    title: 'Science Fundamentals',
                    description: 'Basic science concepts and terminology',
                    category: 'science',
                    questions: [
                        {
                            question: 'What planet is known as the Red Planet?',
                            answers: ['Venus', 'Mars', 'Jupiter', 'Saturn'],
                            correctIndex: 1
                        },
                        {
                            question: 'What is H2O?',
                            answers: ['Oxygen', 'Hydrogen', 'Water', 'Carbon Dioxide'],
                            correctIndex: 2
                        }
                    ],
                    createdAt: '2023-01-01',
                    publishedAt: '2023-01-01'
                }
            ];
        }

        // Handle thumbnail upload
        function handleThumbnailUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (!file.type.match('image.*')) {
                alert('Please select an image file.');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                thumbnailPreview.innerHTML = `<img src="${e.target.result}" alt="Thumbnail preview">`;
            };
            reader.readAsDataURL(file);
        }

        // Switch between tabs
        function switchTab(tabId) {
            tabs.forEach(tab => {
                tab.classList.toggle('active', tab.dataset.tab === tabId);
            });
            
            tabContents.forEach(content => {
                content.classList.toggle('active', content.id === tabId);
            });
            
            if (tabId === 'guides') {
                updateGuideList();
            } else if (tabId === 'browse') {
                updateBrowseList();
            } else if (tabId === 'create') {
                // Reset form when switching to create tab
                resetCreateForm();
            }
        }

        // Reset the create form
        function resetCreateForm() {
            document.getElementById('guide-title').value = '';
            guideDescription.value = '';
            guideCategory.value = '';
            thumbnailUpload.value = '';
            thumbnailPreview.innerHTML = '<span>No image selected</span>';
            questionsContainer.innerHTML = '';
            editingGuideId = null;
            exportJson.value = '';
            addQuestion();
            saveGuideBtn.textContent = 'Save Study Guide';
            publishGuideBtn.style.display = 'block';
        }

        // Add a new question to the form
        function addQuestion() {
            const questionId = Date.now();
            const questionHTML = `
                <div class="question-card" data-id="${questionId}">
                    <div class="form-group">
                        <label>Question</label>
                        <input type="text" class="question-text" placeholder="Enter your question">
                    </div>
                    <div class="form-group">
                        <label>Answers</label>
                        <div class="answer-row">
                            <input type="text" class="answer-text" placeholder="Answer option 1">
                            <div class="checkbox-container">
                                <input type="radio" name="correct-${questionId}" value="0">
                                <span>Correct</span>
                            </div>
                        </div>
                        <div class="answer-row">
                            <input type="text" class="answer-text" placeholder="Answer option 2">
                            <div class="checkbox-container">
                                <input type="radio" name="correct-${questionId}" value="1">
                                <span>Correct</span>
                            </div>
                        </div>
                        <div class="answer-row">
                            <input type="text" class="answer-text" placeholder="Answer option 3">
                            <div class="checkbox-container">
                                <input type="radio" name="correct-${questionId}" value="2">
                                <span>Correct</span>
                            </div>
                        </div>
                        <div class="answer-row">
                            <input type="text" class="answer-text" placeholder="Answer option 4">
                            <div class="checkbox-container">
                                <input type="radio" name="correct-${questionId}" value="3">
                                <span>Correct</span>
                            </div>
                        </div>
                    </div>
                    <button class="remove-question secondary">Remove Question</button>
                </div>
            `;
            
            questionsContainer.insertAdjacentHTML('beforeend', questionHTML);
            
            // Add event listener to the remove button
            const newQuestion = questionsContainer.lastElementChild;
            newQuestion.querySelector('.remove-question').addEventListener('click', function() {
                if (questionsContainer.children.length > 1) {
                    newQuestion.remove();
                } else {
                    alert('You need at least one question in your study guide.');
                }
            });
        }

        // Save the study guide
        function saveStudyGuide() {
            const title = document.getElementById('guide-title').value.trim();
            const description = guideDescription.value.trim();
            const category = guideCategory.value;
            
            if (!title) {
                alert('Please enter a title for your study guide.');
                return;
            }
            
            if (!category) {
                alert('Please select a category for your study guide.');
                return;
            }
            
            const questions = [];
            const questionCards = questionsContainer.querySelectorAll('.question-card');
            
            let hasErrors = false;
            
            questionCards.forEach(card => {
                const questionText = card.querySelector('.question-text').value.trim();
                const answerInputs = card.querySelectorAll('.answer-text');
                const correctInput = card.querySelector('input[type="radio"]:checked');
                
                if (!questionText) {
                    alert('Please fill in all question fields.');
                    hasErrors = true;
                    return;
                }
                
                const answers = [];
                let allAnswersFilled = true;
                
                answerInputs.forEach(input => {
                    const answerText = input.value.trim();
                    if (!answerText) {
                        allAnswersFilled = false;
                    }
                    answers.push(answerText);
                });
                
                if (!allAnswersFilled) {
                    alert('Please fill in all answer fields.');
                    hasErrors = true;
                    return;
                }
                
                if (!correctInput) {
                    alert('Please select the correct answer for each question.');
                    hasErrors = true;
                    return;
                }
                
                questions.push({
                    question: questionText,
                    answers: answers,
                    correctIndex: parseInt(correctInput.value)
                });
            });
            
            if (hasErrors) return;
            
            // Get thumbnail data if available
            let thumbnailData = null;
            const thumbnailImg = thumbnailPreview.querySelector('img');
            if (thumbnailImg) {
                thumbnailData = thumbnailImg.src;
            }
            
            const guideData = {
                title: title,
                description: description,
                category: category,
                thumbnail: thumbnailData,
                questions: questions,
                createdAt: new Date().toLocaleDateString()
            };
            
            if (editingGuideId) {
                // Update existing guide
                const guideIndex = studyGuides.findIndex(guide => guide.id === editingGuideId);
                if (guideIndex !== -1) {
                    studyGuides[guideIndex] = {
                        ...studyGuides[guideIndex],
                        ...guideData
                    };
                }
            } else {
                // Create new guide
                const guide = {
                    id: Date.now(),
                    ...guideData
                };
                studyGuides.push(guide);
            }
            
            localStorage.setItem('studyGuides', JSON.stringify(studyGuides));
            
            alert('Study guide saved successfully!');
            resetCreateForm();
            
            updateGuideSelect();
            updateGuideList();
        }

        // Prepare guide for publishing
        function prepareForPublishing() {
            const title = document.getElementById('guide-title').value.trim();
            
            if (!title) {
                alert('Please save your study guide before preparing for publishing.');
                return;
            }
            
            // Find the guide in studyGuides
            let guideToPublish;
            if (editingGuideId) {
                guideToPublish = studyGuides.find(guide => guide.id === editingGuideId);
            } else {
                // Find the most recently saved guide with this title
                guideToPublish = studyGuides
                    .filter(guide => guide.title === title)
                    .sort((a, b) => b.id - a.id)[0];
            }
            
            if (!guideToPublish) {
                alert('Please save your study guide before preparing for publishing.');
                return;
            }
            
            // Create a clean copy for publishing (remove id and personal data)
            const publishableGuide = {
                title: guideToPublish.title,
                description: guideToPublish.description,
                category: guideToPublish.category,
                thumbnail: guideToPublish.thumbnail,
                questions: guideToPublish.questions,
                createdAt: new Date().toLocaleDateString(),
                publishedAt: new Date().toLocaleDateString()
            };
            
            // Display the JSON for copying
            exportJson.value = JSON.stringify(publishableGuide, null, 2);
            
            alert('Your study guide is ready for publishing! Copy the JSON data and submit it to be included in the community collection.');
        }

        // Copy JSON to clipboard
        function copyJsonToClipboard() {
            if (!exportJson.value) {
                alert('No JSON data to copy. Please prepare your guide for publishing first.');
                return;
            }
            
            exportJson.select();
            exportJson.setSelectionRange(0, 99999); // For mobile devices
            
            try {
                navigator.clipboard.writeText(exportJson.value);
                alert('JSON copied to clipboard! You can now submit this to be added to the community collection.');
            } catch (err) {
                // Fallback for older browsers
                document.execCommand('copy');
                alert('JSON copied to clipboard! You can now submit this to be added to the community collection.');
            }
        }

        // Edit an existing study guide
        function editStudyGuide(id) {
            const guide = studyGuides.find(guide => guide.id === id);
            if (!guide) return;
            
            // Switch to create tab
            switchTab('create');
            
            // Populate form with guide data
            document.getElementById('guide-title').value = guide.title;
            guideDescription.value = guide.description || '';
            guideCategory.value = guide.category || '';
            
            // Set thumbnail if available
            if (guide.thumbnail) {
                thumbnailPreview.innerHTML = `<img src="${guide.thumbnail}" alt="Thumbnail preview">`;
            }
            
            // Clear existing questions
            questionsContainer.innerHTML = '';
            
            // Add questions from the guide
            guide.questions.forEach((q, index) => {
                addQuestion();
                const lastQuestion = questionsContainer.lastElementChild;
                
                // Set question text
                lastQuestion.querySelector('.question-text').value = q.question;
                
                // Set answer texts
                const answerInputs = lastQuestion.querySelectorAll('.answer-text');
                q.answers.forEach((answer, i) => {
                    if (answerInputs[i]) {
                        answerInputs[i].value = answer;
                    }
                });
                
                // Set correct answer
                const correctInput = lastQuestion.querySelector(`input[value="${q.correctIndex}"]`);
                if (correctInput) {
                    correctInput.checked = true;
                }
            });
            
            // Set editing mode
            editingGuideId = id;
            saveGuideBtn.textContent = 'Update Study Guide';
        }

        // Update the study guide select dropdown
        function updateGuideSelect() {
            selectGuide.innerHTML = '<option value="">-- Select a study guide --</option>';
            
            // Add user's guides
            studyGuides.forEach(guide => {
                const option = document.createElement('option');
                option.value = guide.id;
                option.textContent = guide.title + ' (My Guide)';
                selectGuide.appendChild(option);
            });
            
            // Add community guides
            communityGuides.forEach(guide => {
                const option = document.createElement('option');
                option.value = guide.id;
                option.textContent = guide.title + ' (Community)';
                selectGuide.appendChild(option);
            });
        }

        // Update the study guide list
        function updateGuideList() {
            guideList.innerHTML = '';
            
            if (studyGuides.length === 0) {
                guideList.innerHTML = `
                    <div class="empty-state">
                        <i>📚</i>
                        <h3>No Study Guides Yet</h3>
                        <p>Create your first study guide to get started!</p>
                    </div>
                `;
                return;
            }
            
            studyGuides.forEach(guide => {
                const li = document.createElement('li');
                li.className = 'study-guide-item';
                
                const thumbnailContent = guide.thumbnail 
                    ? `<img src="${guide.thumbnail}" alt="${guide.title}">`
                    : `<span>No Image</span>`;
                
                li.innerHTML = `
                    <div class="guide-thumbnail">
                        ${thumbnailContent}
                    </div>
                    <div>
                        <h3>${guide.title}</h3>
                        <p>${guide.description || 'No description'}</p>
                        <div class="guide-meta">
                            <span>${guide.questions.length} questions</span>
                            <span>${guide.category || 'Uncategorized'}</span>
                        </div>
                    </div>
                    <div class="guide-actions">
                        <button class="edit-guide" data-id="${guide.id}">Edit</button>
                        <button class="delete-guide secondary" data-id="${guide.id}">Delete</button>
                    </div>
                `;
                guideList.appendChild(li);
                
                li.querySelector('.edit-guide').addEventListener('click', function() {
                    editStudyGuide(guide.id);
                });
                
                li.querySelector('.delete-guide').addEventListener('click', function() {
                    if (confirm('Are you sure you want to delete this study guide?')) {
                        deleteStudyGuide(guide.id);
                    }
                });
            });
        }

        // Update the browse list with community guides
        function updateBrowseList() {
            browseGuideList.innerHTML = '';
            
            const searchTerm = searchInput.value.toLowerCase();
            const category = categoryFilter.value;
            
            let filteredGuides = communityGuides;
            
            // Filter by search term
            if (searchTerm) {
                filteredGuides = filteredGuides.filter(guide => 
                    guide.title.toLowerCase().includes(searchTerm) ||
                    (guide.description && guide.description.toLowerCase().includes(searchTerm)) ||
                    (guide.category && guide.category.toLowerCase().includes(searchTerm))
                );
            }
            
            // Filter by category
            if (category) {
                filteredGuides = filteredGuides.filter(guide => guide.category === category);
            }
            
            if (filteredGuides.length === 0) {
                browseGuideList.innerHTML = `
                    <div class="empty-state">
                        <i>🔍</i>
                        <h3>No Study Guides Found</h3>
                        <p>Try adjusting your search or filter criteria.</p>
                    </div>
                `;
                return;
            }
            
            filteredGuides.forEach(guide => {
                const li = document.createElement('li');
                li.className = 'study-guide-item';
                
                const thumbnailContent = guide.thumbnail 
                    ? `<img src="${guide.thumbnail}" alt="${guide.title}">`
                    : `<span>No Image</span>`;
                
                li.innerHTML = `
                    <div class="guide-thumbnail">
                        ${thumbnailContent}
                    </div>
                    <div>
                        <h3>${guide.title}</h3>
                        <p>${guide.description || 'No description'}</p>
                        <div class="guide-meta">
                            <span>${guide.questions.length} questions</span>
                            <span>${guide.category || 'Uncategorized'}</span>
                            <span>Published: ${guide.publishedAt}</span>
                        </div>
                    </div>
                    <div class="guide-actions">
                        <button class="study-guide" data-id="${guide.id}">Study</button>
                        <button class="import-guide secondary" data-id="${guide.id}">Import to My Guides</button>
                    </div>
                `;
                browseGuideList.appendChild(li);
                
                li.querySelector('.study-guide').addEventListener('click', function() {
                    // Switch to study tab and select this guide
                    switchTab('study');
                    selectGuide.value = guide.id;
                    startQuiz();
                });
                
                li.querySelector('.import-guide').addEventListener('click', function() {
                    importCommunityGuide(guide);
                });
            });
        }

        // Import a community guide to user's guides
        function importCommunityGuide(guide) {
            // Create a copy for the user
            const userGuide = {
                ...guide,
                id: Date.now()
            };
            
            studyGuides.push(userGuide);
            localStorage.setItem('studyGuides', JSON.stringify(studyGuides));
            
            alert('Study guide imported successfully! You can find it in "My Study Guides".');
            updateGuideSelect();
            updateGuideList();
        }

        // Delete a study guide
        function deleteStudyGuide(id) {
            studyGuides = studyGuides.filter(guide => guide.id !== id);
            localStorage.setItem('studyGuides', JSON.stringify(studyGuides));
            updateGuideSelect();
            updateGuideList();
        }

        // Export all study guides
        function exportAllGuides() {
            if (studyGuides.length === 0) {
                alert('No study guides to export.');
                return;
            }
            
            const dataStr = JSON.stringify(studyGuides, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = 'study-guides.json';
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }

        // Import study guides
        function importGuides(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedGuides = JSON.parse(e.target.result);
                    
                    if (!Array.isArray(importedGuides)) {
                        throw new Error('Invalid file format');
                    }
                    
                    // Merge with existing guides
                    studyGuides = studyGuides.concat(importedGuides);
                    localStorage.setItem('studyGuides', JSON.stringify(studyGuides));
                    
                    updateGuideSelect();
                    updateGuideList();
                    
                    alert(`Successfully imported ${importedGuides.length} study guide(s)!`);
                    
                    // Reset file input
                    importFile.value = '';
                } catch (error) {
                    alert('Error importing study guides. Please make sure you selected a valid JSON file.');
                    console.error(error);
                }
            };
            reader.readAsText(file);
        }

        // Clear all study guides
        function clearAllGuides() {
            if (studyGuides.length === 0) {
                alert('No study guides to clear.');
                return;
            }
            
            if (confirm('Are you sure you want to delete ALL study guides? This action cannot be undone.')) {
                studyGuides = [];
                localStorage.setItem('studyGuides', JSON.stringify(studyGuides));
                updateGuideSelect();
                updateGuideList();
                alert('All study guides have been cleared.');
            }
        }

        // Start the quiz
        function startQuiz() {
            const selectedGuideId = selectGuide.value;
            if (!selectedGuideId) {
                alert('Please select a study guide.');
                return;
            }
            
            // Check if it's a community guide or user's guide
            if (selectedGuideId.includes('demo-') || selectedGuideId.length > 10) {
                currentGuide = communityGuides.find(guide => guide.id === selectedGuideId);
            } else {
                currentGuide = studyGuides.find(guide => guide.id == selectedGuideId);
            }
            
            if (!currentGuide) {
                alert('Selected study guide not found.');
                return;
            }
            
            // Create a shuffled copy of questions for the quiz
            currentQuiz = [...currentGuide.questions].sort(() => Math.random() - 0.5);
            currentQuestionIndex = 0;
            userAnswers = new Array(currentQuiz.length).fill(null);
            quizInProgress = true;
            
            document.getElementById('study-setup').style.display = 'none';
            quizContainer.style.display = 'block';
            resultsContainer.style.display = 'none';
            
            showCurrentQuestion();
        }

        // Show the current question
        function showCurrentQuestion() {
            if (!currentQuiz || currentQuestionIndex >= currentQuiz.length) {
                showResults();
                return;
            }
            
            const question = currentQuiz[currentQuestionIndex];
            
            // Create shuffled answer indices
            const answerIndices = [0, 1, 2, 3].sort(() => Math.random() - 0.5);
            
            let answersHTML = '';
            answerIndices.forEach((index, i) => {
                const isSelected = userAnswers[currentQuestionIndex] === index;
                answersHTML += `
                    <div class="answer-option ${isSelected ? 'selected' : ''}" data-index="${index}">
                        ${question.answers[index]}
                    </div>
                `;
            });
            
            questionDisplay.innerHTML = `
                <div class="question-title">${currentQuestionIndex + 1}. ${question.question}</div>
                <div class="answers-container">
                    ${answersHTML}
                </div>
            `;
            
            // Add event listeners to answer options
            questionDisplay.querySelectorAll('.answer-option').forEach(option => {
                option.addEventListener('click', function() {
                    // Remove selected class from all options
                    questionDisplay.querySelectorAll('.answer-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    
                    // Add selected class to clicked option
                    this.classList.add('selected');
                    
                    // Store the user's answer
                    const selectedIndex = parseInt(this.dataset.index);
                    userAnswers[currentQuestionIndex] = selectedIndex;
                    
                    // Show instant feedback if enabled
                    if (instantFeedbackEnabled) {
                        showInstantFeedback(question, selectedIndex);
                    }
                });
            });
            
            // Update progress bar
            const progress = ((currentQuestionIndex + 1) / currentQuiz.length) * 100;
            quizProgress.style.width = `${progress}%`;
            
            // Update button states
            prevQuestionBtn.disabled = currentQuestionIndex === 0;
            nextQuestionBtn.textContent = currentQuestionIndex === currentQuiz.length - 1 ? 'Finish' : 'Next';
            
            // Clear feedback message
            feedbackMessage.style.display = 'none';
        }

        // Show instant feedback for the selected answer
        function showInstantFeedback(question, selectedIndex) {
            const isCorrect = selectedIndex === question.correctIndex;
            
            // Update feedback message
            feedbackMessage.textContent = isCorrect 
                ? "Correct! Well done!" 
                : "Incorrect. Try again!";
            
            feedbackMessage.className = `feedback-message ${isCorrect ? 'feedback-correct' : 'feedback-incorrect'}`;
            feedbackMessage.style.display = 'block';
            
            // Highlight correct and incorrect answers
            questionDisplay.querySelectorAll('.answer-option').forEach(option => {
                const optionIndex = parseInt(option.dataset.index);
                
                if (optionIndex === question.correctIndex) {
                    option.classList.add('correct');
                } else if (optionIndex === selectedIndex && !isCorrect) {
                    option.classList.add('incorrect');
                }
            });
        }

        // Show the previous question
        function showPreviousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                showCurrentQuestion();
            }
        }

        // Show the next question
        function showNextQuestion() {
            if (currentQuestionIndex < currentQuiz.length - 1) {
                currentQuestionIndex++;
                showCurrentQuestion();
            } else {
                showResults();
            }
        }

        // Show the quiz results
        function showResults() {
            quizContainer.style.display = 'none';
            resultsContainer.style.display = 'block';
            
            let correctCount = 0;
            
            currentQuiz.forEach((question, index) => {
                if (userAnswers[index] === question.correctIndex) {
                    correctCount++;
                }
            });
            
            const score = Math.round((correctCount / currentQuiz.length) * 100);
            
            resultsContainer.innerHTML = `
                <div class="results">
                    <h2>Quiz Complete!</h2>
                    <div class="score">${score}%</div>
                    <p>You answered ${correctCount} out of ${currentQuiz.length} questions correctly.</p>
                    <div class="action-buttons">
                        <button id="restart-quiz">Restart Quiz</button>
                        <button id="new-quiz" class="secondary">New Quiz</button>
                    </div>
                </div>
            `;
            
            document.getElementById('restart-quiz').addEventListener('click', startQuiz);
            document.getElementById('new-quiz').addEventListener('click', function() {
                document.getElementById('study-setup').style.display = 'block';
                resultsContainer.style.display = 'none';
                quizInProgress = false;
            });
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
